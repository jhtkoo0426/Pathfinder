{% extends 'base_pages/base.html' %}
{% load static %}
{% block styles %}
    <link rel="stylesheet" type="text/css" href="{% static 'css/pathfinder.css' %}">
{% endblock %}
{% block content %}
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
    <h1>Pathfinder</h1>
    <p>Enter start and end stations to find their distance.</p><br>

    <!-- Form to ask user for starting and ending stations -->
    <label for="user-start-stn">Your starting station: <span class="span_error_start"></span></label>
    <input type="text" id="user-start-stn" autofocus=""><br>
    <label for="user-end-stn">Your destination: <span class="span_error_end"></span></label>
    <input type="text" id="user-end-stn" autofocus=""><br><br>
    <button type="button" id="sender">Send data</button><br>

    <!-- Display algorithm results -->
    <p>Distance = <span class="span_distance"></span></p>
    <p>ID Path: <span class="span_id_path"></span></p>
    <p>Name Path: <span class="span_name_path"></span></p>
    <div id="map"></div>

    <!-- Async script executes immediately and must be after any DOM elements used in callback. -->
    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDbdBjq8tdxsYt-ui9hy_sUXxY8RYOgkxg&callback=initMap&v=weekly"
      async
    ></script>
    <script>
        let map;
        var marker_array = [];

        function initMap() {
            map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: 51.5080184, lng: -0.1279401 },
                zoom: 10,
            });

            {% for station in stations %}
                // Create marker for station and plot on google maps.
                var marker = new google.maps.Circle({
                    strokeColor: "{{ station.lineColor }}",
                    strokeOpacity: 1,
                    strokeWeight: 1,
                    fillColor: "{{ station.lineColor }}",
                    fillOpacity: 0.35,
                    map: map,
                    center: {lat: {{ station.lat }}, lng: {{ station.lng }}},
                    title: "{{ station.name }}",
                    radius: map.getZoom() * 10,
                    label: {
                        fontsize: "8pt",
                        text: "{{ station.name }}"
                    }
                });

                marker_array.push(marker);
            {% endfor %}
        }

        function animateRoute() {

        }
        // Ajax method to send and receive data (to prevent page reload).
        $("#sender").click(function () {
            var user_start = $('#user-start-stn').val();
            var user_end = $('#user-end-stn').val();

            $.ajax({
                url: '{% url 'get_response' %}',
                data: {
                    'user_start': user_start,
                    'user_end': user_end
                },
                dataType: 'json',
                success: function (data) {
                    document.querySelector('.span_distance').innerHTML = data["calculated_distance"];
                    document.querySelector('.span_id_path').innerHTML = data["calculated_id_path"];
                    document.querySelector('.span_name_path').innerHTML = data["calculated_name_path"];
                    document.querySelector('.span_error_start').innerHTML = data["error_start"];
                }
            });
        });
    </script>

    <!-- Using conditions in a template -->
{#    {% if my_num == 0.01 %}#}
{#        <li>Yes</li>#}
{#    {% else %}#}
{#        <li>No</li>#}
{#    {% endif %}#}
{% endblock %}